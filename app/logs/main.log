Mon, 09 Jul 2018 18:08:31 +0000 string(26) "In CrudOperation, settings"
Mon, 09 Jul 2018 18:08:31 +0000 string(15) "Getting Config:"
Mon, 09 Jul 2018 18:08:31 +0000 string(17) "Returning Config:"
Mon, 09 Jul 2018 18:08:31 +0000 string(10) "Got DB Con"
Mon, 09 Jul 2018 18:08:31 +0000 string(377) "{"dbhost":"localhost","dbport":"3306","dbuser":"nhp123!!!","dbpass":"nhp123!!!","dbname":"nochero_pilot","basedir":"\/var\/www\/html\/pilot","unzip":"\/bin\/unzip","php":"\/bin\/php","weburl":"https:\/\/secure.virtuops.com\/pilot","curl":"\/bin\/curl","perldoc":"\/bin\/perldoc","logfile":"\/var\/www\/html\/pilot\/app\/logs\/main.log","ldaphost":"","ldapport":"0","ldapou":""}"
Mon, 09 Jul 2018 18:08:35 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:08:35 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:08:45 +0000 string(26) "In CrudOperation, settings"
Mon, 09 Jul 2018 18:08:45 +0000 string(15) "Getting Config:"
Mon, 09 Jul 2018 18:08:45 +0000 string(17) "Returning Config:"
Mon, 09 Jul 2018 18:08:45 +0000 string(10) "Got DB Con"
Mon, 09 Jul 2018 18:08:45 +0000 string(377) "{"dbhost":"localhost","dbport":"3306","dbuser":"nhp123!!!","dbpass":"nhp123!!!","dbname":"nochero_pilot","basedir":"\/var\/www\/html\/pilot","unzip":"\/bin\/unzip","php":"\/bin\/php","weburl":"https:\/\/secure.virtuops.com\/pilot","curl":"\/bin\/curl","perldoc":"\/bin\/perldoc","logfile":"\/var\/www\/html\/pilot\/app\/logs\/main.log","ldaphost":"","ldapport":"0","ldapou":""}"
Mon, 09 Jul 2018 18:08:49 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:08:49 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:09:25 +0000 string(27) "In CrudOperation, workflows"
Mon, 09 Jul 2018 18:09:34 +0000 string(26) "In CrudOperation, runbooks"
Mon, 09 Jul 2018 18:09:34 +0000 string(15) "Runbook Id is  "
Mon, 09 Jul 2018 18:09:34 +0000 string(5) "empty"
Mon, 09 Jul 2018 18:09:34 +0000 string(16) "Runbook SQL is  "
Mon, 09 Jul 2018 18:09:34 +0000 string(22) "select * from runbooks"
Mon, 09 Jul 2018 18:09:34 +0000 string(10) "Returning:"
Mon, 09 Jul 2018 18:09:34 +0000 string(141) "{"total":1,"records":[{"runbookid":"WFTasks","runbookname":"WF Tasks","runbookdescription":"Tasks that pertain to all workflows","recid":1}]}"
Mon, 09 Jul 2018 18:09:35 +0000 string(31) "In CrudOperation, task_runbooks"
Mon, 09 Jul 2018 18:09:35 +0000 string(23) "RunbookTaskRead SQL is "
Mon, 09 Jul 2018 18:09:35 +0000 string(96) "select taskname, taskorder from task_runbooks where runbookid = 'WFTasks' order by taskorder asc"
Mon, 09 Jul 2018 18:09:35 +0000 string(26) "RunbookTaskRead DB Error: "
Mon, 09 Jul 2018 18:09:35 +0000 string(0) ""
Mon, 09 Jul 2018 18:09:35 +0000 string(10) "Returning:"
Mon, 09 Jul 2018 18:09:35 +0000 string(923) "{"total":16,"records":[{"taskname":"VP Read Data","taskorder":"1","recid":1},{"taskname":"VP REST Query","taskorder":"2","recid":2},{"taskname":"VP DNS Device","taskorder":"3","recid":3},{"taskname":"VP Count File Rows","taskorder":"4","recid":4},{"taskname":"VP Write To File","taskorder":"5","recid":5},{"taskname":"VP MySQL Query","taskorder":"6","recid":6},{"taskname":"VP SSH","taskorder":"7","recid":7},{"taskname":"VP SNMP Walk","taskorder":"8","recid":8},{"taskname":"VP Generic Task","taskorder":"9","recid":9},{"taskname":"VP DB2 Query","taskorder":"10","recid":10},{"taskname":"VP Create Dir","taskorder":"11","recid":11},{"taskname":"VP TDS Query","taskorder":"12","recid":12},{"taskname":"VP Email Task","taskorder":"13","recid":13},{"taskname":"VP Ping Device","taskorder":"14","recid":14},{"taskname":"VP Empty File","taskorder":"15","recid":15},{"taskname":"VP JSON to NDJSON","taskorder":"16","recid":16}]}"
Mon, 09 Jul 2018 18:09:35 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:09:39 +0000 string(26) "In CrudOperation, runbooks"
Mon, 09 Jul 2018 18:09:39 +0000 string(15) "Runbook Id is  "
Mon, 09 Jul 2018 18:09:39 +0000 string(5) "empty"
Mon, 09 Jul 2018 18:09:39 +0000 string(16) "Runbook SQL is  "
Mon, 09 Jul 2018 18:09:39 +0000 string(22) "select * from runbooks"
Mon, 09 Jul 2018 18:09:39 +0000 string(10) "Returning:"
Mon, 09 Jul 2018 18:09:39 +0000 string(141) "{"total":1,"records":[{"runbookid":"WFTasks","runbookname":"WF Tasks","runbookdescription":"Tasks that pertain to all workflows","recid":1}]}"
Mon, 09 Jul 2018 18:09:40 +0000 string(31) "In CrudOperation, task_runbooks"
Mon, 09 Jul 2018 18:09:40 +0000 string(23) "RunbookTaskRead SQL is "
Mon, 09 Jul 2018 18:09:40 +0000 string(96) "select taskname, taskorder from task_runbooks where runbookid = 'WFTasks' order by taskorder asc"
Mon, 09 Jul 2018 18:09:40 +0000 string(26) "RunbookTaskRead DB Error: "
Mon, 09 Jul 2018 18:09:40 +0000 string(0) ""
Mon, 09 Jul 2018 18:09:40 +0000 string(10) "Returning:"
Mon, 09 Jul 2018 18:09:40 +0000 string(923) "{"total":16,"records":[{"taskname":"VP Read Data","taskorder":"1","recid":1},{"taskname":"VP REST Query","taskorder":"2","recid":2},{"taskname":"VP DNS Device","taskorder":"3","recid":3},{"taskname":"VP Count File Rows","taskorder":"4","recid":4},{"taskname":"VP Write To File","taskorder":"5","recid":5},{"taskname":"VP MySQL Query","taskorder":"6","recid":6},{"taskname":"VP SSH","taskorder":"7","recid":7},{"taskname":"VP SNMP Walk","taskorder":"8","recid":8},{"taskname":"VP Generic Task","taskorder":"9","recid":9},{"taskname":"VP DB2 Query","taskorder":"10","recid":10},{"taskname":"VP Create Dir","taskorder":"11","recid":11},{"taskname":"VP TDS Query","taskorder":"12","recid":12},{"taskname":"VP Email Task","taskorder":"13","recid":13},{"taskname":"VP Ping Device","taskorder":"14","recid":14},{"taskname":"VP Empty File","taskorder":"15","recid":15},{"taskname":"VP JSON to NDJSON","taskorder":"16","recid":16}]}"
Mon, 09 Jul 2018 18:09:40 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:09:48 +0000 string(26) "In CrudOperation, runbooks"
Mon, 09 Jul 2018 18:09:48 +0000 string(15) "Runbook Id is  "
Mon, 09 Jul 2018 18:09:48 +0000 string(5) "empty"
Mon, 09 Jul 2018 18:09:48 +0000 string(16) "Runbook SQL is  "
Mon, 09 Jul 2018 18:09:48 +0000 string(22) "select * from runbooks"
Mon, 09 Jul 2018 18:09:48 +0000 string(10) "Returning:"
Mon, 09 Jul 2018 18:09:48 +0000 string(141) "{"total":1,"records":[{"runbookid":"WFTasks","runbookname":"WF Tasks","runbookdescription":"Tasks that pertain to all workflows","recid":1}]}"
Mon, 09 Jul 2018 18:09:48 +0000 string(31) "In CrudOperation, task_runbooks"
Mon, 09 Jul 2018 18:09:48 +0000 string(23) "RunbookTaskRead SQL is "
Mon, 09 Jul 2018 18:09:48 +0000 string(96) "select taskname, taskorder from task_runbooks where runbookid = 'WFTasks' order by taskorder asc"
Mon, 09 Jul 2018 18:09:48 +0000 string(26) "RunbookTaskRead DB Error: "
Mon, 09 Jul 2018 18:09:48 +0000 string(0) ""
Mon, 09 Jul 2018 18:09:48 +0000 string(10) "Returning:"
Mon, 09 Jul 2018 18:09:48 +0000 string(923) "{"total":16,"records":[{"taskname":"VP Read Data","taskorder":"1","recid":1},{"taskname":"VP REST Query","taskorder":"2","recid":2},{"taskname":"VP DNS Device","taskorder":"3","recid":3},{"taskname":"VP Count File Rows","taskorder":"4","recid":4},{"taskname":"VP Write To File","taskorder":"5","recid":5},{"taskname":"VP MySQL Query","taskorder":"6","recid":6},{"taskname":"VP SSH","taskorder":"7","recid":7},{"taskname":"VP SNMP Walk","taskorder":"8","recid":8},{"taskname":"VP Generic Task","taskorder":"9","recid":9},{"taskname":"VP DB2 Query","taskorder":"10","recid":10},{"taskname":"VP Create Dir","taskorder":"11","recid":11},{"taskname":"VP TDS Query","taskorder":"12","recid":12},{"taskname":"VP Email Task","taskorder":"13","recid":13},{"taskname":"VP Ping Device","taskorder":"14","recid":14},{"taskname":"VP Empty File","taskorder":"15","recid":15},{"taskname":"VP JSON to NDJSON","taskorder":"16","recid":16}]}"
Mon, 09 Jul 2018 18:09:48 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:15:27 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:15:28 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:16:43 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:16:43 +0000 string(32) "TaskCreateUpdate: New Params are"
Mon, 09 Jul 2018 18:16:43 +0000 array(14) {
  ["taskname"]=>
  string(13) "VP REST Query"
  ["urlparams"]=>
  string(83) "user,password,curlpath,url,method,header1,header2,header3,data,cmdoutput,databinary"
  ["userparams"]=>
  string(0) ""
  ["actiontext"]=>
  string(2162) "#
# Performs a REST API query to an endpoint.
#

use strict;
use warnings;
use JSON;
use Getopt::Long;
use Data::Dumper;

my %output;

my ($method,$header1,$header2,$header3,$databinary,$arrayname,$curlpath,$user,$url,$password,$data,$cmdoutput,$status);


GetOptions(
        "method=s" => \$method,
        "curlpath=s" => \$curlpath,
        "user:s" => \$user,
        "url=s" => \$url,
        "password:s" => \$password,
        "data:s" => \$data,
        "databinary:s" => \$databinary,
        "header1:s" => \$header1,
        "header2:s" => \$header2,
        "header3:s" => \$header3,
        "arrayname:s" => \$arrayname,
        "cmdoutput:s" => \$cmdoutput
        );
        
        

if (defined($cmdoutput)){
open (FILEDATA,"+> $cmdoutput");
}
#my $createcmd = $curlpath." -s -X ".$method." -H 'Content-Type: application/json' -d '".$data."' -u '".$user.":".$password."' https://".$domain."/api/now/table/".$table." 2>&1";

my $createcmd = $curlpath." -s -X ".$method;
my $postdata;

if (defined($header1)){
$createcmd .= " -H ".$header1." ";
}

if (defined($header2)){
$createcmd .= " -H ".$header2." ";
}

if (defined($header3)){
$createcmd .= " -H ".$header3." ";
}

if (defined($user) && defined($password) && length($user) > 0 && length($password) > 0) {
$createcmd .= " -u '".$user.":".$password."'";
} elsif (defined($user) && length($user) > 0) {
$createcmd .= " -u '".$user."'";
}

if (defined($data)) {
 
     $createcmd .= " -d '".$data."' ";
     
} elsif (defined($databinary)) {
    $createcmd .= " --data-binary '".$databinary."' ";
    
}

$createcmd .= " '".$url."' ";

my $createrequest = `$createcmd`;
my $meta = $arrayname."_meta";
$output{"$arrayname"} = decode_json($createrequest);


if (defined($cmdoutput)){
print FILEDATA $createrequest;
}

if (length($createrequest) > 0) {
        $status = "Created";
        $output{"$meta"}{"count"} = 1;
} else {
        $status = "Problem Creating Entry";
}

$output{'status'} = $status;


my $json = encode_json(\%output);
print $json;

if (defined($cmdoutput)){
close(FILEDATA);
}
"
  ["actionlanguage"]=>
  string(4) "perl"
  ["actionfilename"]=>
  string(12) "restquery.pl"
  ["taskdescription"]=>
  string(1218) "Synopsis:  Performs REST Query to an endpoint.  Great for performing tasks involving applications that have a REST API.

Input Params: 

user = string for the REST user credentials
password = string for the REST Password credentials
curlpath = path to curl on your server
nheader<1-3> = headers to pass to the request, example Accept:application/json
url = string for the url for the REST service.
method = POST, GET, PUT etc.
data = string that you pass to the REST request that is used as data for the request.
cmdoutput = string that indicates where you will store the reply from the rest service.  
     Needs to be a full path to a file on your pilot server that your web server user can write to.   
	 Example /var/www/html/pilot/tmp/files/restresult.json

Output param:  
	status
 
Output values:  

	Created, Problem Creating Entry
	
Sample Params Config (fill in over on the left): 

{
"user":"restuser",
"password":"restpass",
"method":"POST",
"curlpath":"/bin/curl",
"url":"https://mycompany.restinterface.com/some/rest/query/endpoint",
"header1":"Accept:application/json",
"cmdoutput":"/var/www/html/pilot/tmp/files/out.json",
"data":{"field1":"value1","field2":"value2"}
}"
  ["datatype"]=>
  string(4) "JSON"
  ["jprop"]=>
  string(0) ""
  ["fieldseparator"]=>
  string(0) ""
  ["recordseparator"]=>
  string(0) ""
  ["outputfields"]=>
  string(102) "#ID, TYPE, PARAM, REQUIRED, CAPTION, STYLE, LIST
status,text,false,false,Status:,style="width: 300px""
  ["outputactions"]=>
  string(0) ""
  ["recid"]=>
  string(2) "12"
}
Mon, 09 Jul 2018 18:16:43 +0000 string(218) "

task status of perl lint on file /var/www/html/pilot/app/server/admin/../actiontext/restquery.pl
output is ""
err is "\/var\/www\/html\/pilot\/app\/server\/admin\/..\/actiontext\/restquery.pl syntax OK\n"
exit is 0

"
Mon, 09 Jul 2018 18:16:43 +0000 string(255) "
Executing sql replace into tasks (taskname, urlparams, userparams, actiontext, actionlanguage, actionfilename, outputfields, outputactions, taskdescription, datatype, jprop, fieldseparator, recordseparator) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
"
Mon, 09 Jul 2018 18:16:43 +0000 string(27) "TaskCreateUpdate DB Error: "
Mon, 09 Jul 2018 18:16:43 +0000 int(2)
Mon, 09 Jul 2018 18:16:43 +0000 string(0) ""
Mon, 09 Jul 2018 18:16:48 +0000 string(23) "In CrudOperation, tasks"
Mon, 09 Jul 2018 18:16:48 +0000 string(23) "In CrudOperation, tasks"
